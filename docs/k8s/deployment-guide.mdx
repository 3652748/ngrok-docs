import Tabs from "@theme/Tabs";
import TabItem from "@theme/TabItem";

# Deployment Guide

This guide is meant as the starting point for configuring, deploying, and operating the controller component itself. It focuses on configurations and settings for the whole controller, and thus its corresponding ingress class, rather than individual ingress resources and their annotations.

## Prerequisites

- A k8s cluster and access to it via kubectl - We recommend using a recent version of k8s and will specify and test past versions as a part of https://github.com/ngrok/kubernetes-ingress-controller/issues/154
- helm - 3.0.0 or later.

## Installation

<Tabs groupId="k8s" queryString="k8s-basic">
	<TabItem value="ingress" label="Ingress Controller" default>

	</TabItem>
	<TabItem value="gatewayAPI" label="Gateway API">

	</TabItem>
</Tabs>

It is recommended to use helm to install the operator. Alternatively, the container is available on docker hub at `ngrok/ingress-controller` and can be run directly with hand crafted manifests.

To install via helm, run the following commands to export your credentials as environment variables and add the operator to helm:

```bash
export NGROK_API_KEY=<YOUR Secret API KEY>
export NGROK_AUTHTOKEN=<YOUR Secret Auth Token>
helm repo add ngrok https://ngrok.github.io/kubernetes-ingress-controller
```

<Tabs groupId="k8s" queryString="k8s-basic">
	<TabItem value="ingress" label="Ingress Controller" default>
Run the following commands to instal the ingress controller 
```bash
helm install ngrok-ingress-controller ngrok/kubernetes-ingress-controller \
  --namespace ngrok-ingress-controller \
  --create-namespace \
  --set credentials.apiKey=$NGROK_API_KEY \
  --set credentials.authtoken=$NGROK_AUTHTOKEN
```
	</TabItem>
	<TabItem value="gatewayAPI" label="Gateway API">
Run the following commands to instal the core Gateway API CRDs and the Gateway API components of the ngrok Kubernetes Operator 
```bash
kubectl apply -f https://github.com/kubernetes-sigs/gateway-api/releases/download/v1.0.0/standard-install.yaml
helm install ngrok-ingress-controller ngrok/kubernetes-ingress-controller \
  --namespace ngrok-ingress-controller \
  --create-namespace \
  --set credentials.apiKey=$NGROK_API_KEY \
  --set credentials.authtoken=$NGROK_AUTHTOKEN
    --set useExperimentalGatewayApi=true
```
	</TabItem>
</Tabs>



For a more robust _infrastructure as code_ way of passing your credentials, see the [credentials](./credentials#setup) page.

Once installed and healthy, you can try creating an ingress object using the output example from the helm install!

### Alternatively

For a quick install, you can also use the combined manifests directly from the repo and begin changing resources:

```bash
kubectl apply -n ngrok-ingress-controller -f https://raw.githubusercontent.com/ngrok/kubernetes-ingress-controller/main/manifest-bundle.yaml
```

## Other Topics

Below are various other topics for a deployer or operator to be aware of.

- [credentials](./credentials)
- [common helm overrides](./common-helm-k8s-overrides)
- [multiple installations](./multiple-installations)
- [white label agent ingress](./white-label-agent-ingress)
- [metrics](./metrics)
- [ngrok regions](./ngrok-regions)
